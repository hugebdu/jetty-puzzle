<!DOCTYPE html>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>

    <script type="text/javascript">

        /* How to correctly createa plug in */

        $(document).ready(function() {

            var zi = 1;
            var EmptySquare = 16;

            var swap = function(aIdx, bIdx) {
                var a = $("#board").children("#" + aIdx).first();
                var b = $("#board").children("#" + bIdx).first();

                var oldx = a.css("left");
                var oldy = a.css("top");

                var newx = b.css("left");
                var newy = b.css("top");

                a.animate({ left: newx, top: newy }, 300);
                b.animate({ left: oldx, top: oldy }, 300);
            };

            function Move(clicked_square) {
                // Locate movable tiles based on where the empty spot is, we can only move the four surrounding squares
                var movable = false;

                // Swap x/y between the clicked square and the currently empty square
                var oldx = $("#board").children("div:nth-child(" + EmptySquare + ")").css("left");
                var oldy = $("#board").children("div:nth-child(" + EmptySquare + ")").css("top");
                var newx = $(clicked_square).css("left");
                var newy = $(clicked_square).css("top");

                alert($(clicked_square).attr("id"));

                // The clicked square is north of the empty square
                if (oldx == newx && newy == (parseInt(oldy) - 128) + 'px')
                    movable = true;

                // The clicked square is south of the empty square
                if (oldx == newx && newy == (parseInt(oldy) + 128) + 'px')
                    movable = true;

                // The clicked square is west of the empty square
                if ((parseInt(oldx) - 128) + 'px' == newx && newy == oldy)
                    movable = true;

                // The clicked square is east of the empty square
                if ((parseInt(oldx) + 128) + 'px' == newx && newy == oldy)
                    movable = true;

                if (movable) {
                    // Increment zindex so the new tile is always on top of all others
                    $(clicked_square).css("z-index", zi++);

                    // Swap squares... Animate new square into old square position
                    $(clicked_square).animate({ left: oldx, top: oldy }, 200, function () {
                        //Move old square into new square position
                        $("#board").children("div:nth-child(" + EmptySquare + ")").css("left", newx);
                        $("#board").children("div:nth-child(" + EmptySquare + ")").css("top", newy);
                    });
                }
            }

            $.fn.extend({ fifteen: function (square_size) {
                var targetElement = "#" + $(this).attr("id");
                var boardSize = (square_size * 4) + 'px';
                $(targetElement).html("<div id = 'board'></div>"); // Inject DIV into target, this is our game board
                $("#board").css({ position: 'absolute', width: boardSize, height: boardSize, border: '1px solid gray' });
                // Populate the game board's HTML container with 15 squares
                for (var i = 0; i < 16; i++) {
                    var cell = $("<div style = 'position: absolute; left: " + ((i % 4) * square_size) + "px; top: " + Math.floor(i / 4) * square_size + "px; width: " + square_size + "px; height: " + square_size + "px; text-align: center; line-height: 128px; -moz-box-shadow: inset 0 0 20px #555555; -webkit-box-shadow: inset 0 0 20px #555555; box-shadow: inset 0 0 20px #555555; background: #ffffff url(images/monalisa.png) " + (-(i % 4) * square_size) + "px " + -Math.floor(i / 4) * square_size + "px no-repeat !important'></div>");
                    var x = $("#board").append(cell);
                    cell.attr("id", i);
                }
                // Empty up the 16th square, as the starting point
                $("#board").children("div:nth-child(" + EmptySquare + ")").css({backgroundImage: "", background: "#ffffff"});
                // Attach click event to each square
                $("#board").children("div").click(function () {
                    Move(this);
                });

                $(targetElement).data("swap", swap);
            }

            });

            $("#target").fifteen(128); // Create a game with 32x32 squares inside "#target" div
            var func = $("#target").data('swap');
            setTimeout(function() { func(1, 8); }, 2000);


        });

    </script>
</head>
<body>

<h1>jQuery Image Block Sliding Game (<i>with source code</i>)</h1>

<div id="target"></div>
</body>
</html>

